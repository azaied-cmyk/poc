/*************************************************************************
 *
 * VLOCITY, INC. CONFIDENTIAL
 * __________________
 *
 *  [2014] - [2020] Vlocity, Inc.
 *  All Rights Reserved.
 *
 * NOTICE:  All information contained herein is, and remains
 * the property of Vlocity, Inc. and its suppliers,
 * if any. The intellectual and technical concepts contained
 * herein are proprietary to Vlocity, Inc. and its suppliers and may be
 * covered by U.S. and Foreign Patents, patents in process, and are
 * protected by trade secret or copyright law. Dissemination of this
 * information and reproduction, modification or reverse-engineering
 * of this material, is prohibited unless prior written permission
 * is obtained from Vlocity, Inc.
 *
 * Build: v234.0.0
 */
/**
 * This method is used to identify whether the user is in a community page or not.
 */
import { isCommunity } from "c/salesforceUtils";

let pendingPromise = [];

function isCommunityPage() {
  var stored = sessionStorage.getItem("vlocity.isCommunityPage");
  try {
    let cachedResponse =
      stored && typeof stored === "string" ? JSON.parse(stored) : null;
    if (cachedResponse != null) {
      return new Promise(function(resolve) {
        resolve(cachedResponse);
      });
    }
  } catch (e) {
    (() => {})();
  }

  return new Promise(function(resolve) {
    if (!pendingPromise.length) {
      let promise = isCommunity().then(result => {
        sessionStorage.setItem(
          "vlocity.isCommunityPage",
          JSON.stringify(result)
        );
        return result;
      });
      pendingPromise.push(promise);
    }
    resolve(pendingPromise[0]);
  });
}

export default isCommunityPage;
