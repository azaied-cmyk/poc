/*************************************************************************
 *
 * VLOCITY, INC. CONFIDENTIAL
 * __________________
 *
 *  [2014] - [2020] Vlocity, Inc.
 *  All Rights Reserved.
 *
 * NOTICE:  All information contained herein is, and remains
 * the property of Vlocity, Inc. and its suppliers,
 * if any. The intellectual and technical concepts contained
 * herein are proprietary to Vlocity, Inc. and its suppliers and may be
 * covered by U.S. and Foreign Patents, patents in process, and are
 * protected by trade secret or copyright law. Dissemination of this
 * information and reproduction, modification or reverse-engineering
 * of this material, is prohibited unless prior written permission
 * is obtained from Vlocity, Inc.
 *
 * Build: v234.0.0
 */
import { createElement } from "lwc";
import datatable from "c/dataTable";

describe("c-data-table", () => {
  afterEach(() => {
    while (document.body.firstChild) {
      document.body.removeChild(document.body.firstChild);
    }
  });

  it("renders DOM elements", () => {
    const element = createElement("c-data-table", {
      is: datatable
    });
    element.columns = [];
    element.records = [];
    document.body.appendChild(element);
    expect(element.shadowRoot.children).not.toHaveLength(0);
  });

  it("creates data table", () => {
    const element = createElement("c-data-table", {
      is: datatable
    });
    element.rowLevelEdit = "true";
    element.pagesize = "1";
    element.issortavailable = "true";
    document.body.appendChild(element);

    return Promise.resolve().then(() => {
      element.columns = [
        {
          fieldName: "company",
          label: "Company",
          sortable: true,
          searchable: true
        },
        {
          fieldName: "email",
          label: "Email",
          sortable: true,
          searchable: true,
          type: "email",
          editable: true,
          userSelectable: true
        },
        {
          fieldName: "age",
          label: "Age",
          sortable: true,
          type: "number",
          editable: true,
          userSelectable: true
        }
      ];
      element.records = [
        {
          id: "5b5949d7e9a3b7f6e3d0ffcb",
          isActive: true,
          balance: "$3,390.43",
          picture: "http://placehold.it/32x32",
          age: 28,
          eyeColor: "brown",
          company: "EXOSPACE",
          email: "madgedickerson@exospace.com",
          phone: "+1 (977) 568-2404",
          address: "280 Senator Street, Reno, Texas, 1385",
          registered: "<ReferenceError: moment is not defined>",
          latitude: -46.592853,
          longitude: -2.752586
        },
        {
          id: "5b5949d7181ece56a0e006b3",
          isActive: false,
          balance: "$2,715.89",
          picture: "http://placehold.it/32x32",
          age: 35,
          eyeColor: "blue",
          company: "LOTRON",
          email: "madgedickerson@kidgrease.com",
          phone: "+1 (844) 480-3827",
          address: "326 Centre Street, Bascom, Hawaii, 1379",
          registered: "<ReferenceError: moment is not defined>",
          latitude: 89.496124,
          longitude: 74.9523
        },
        {
          id: "5b5949d78e93fe6ba6c4ded4",
          isActive: false,
          balance: "$1,410.73",
          picture: "http://placehold.it/32x32",
          age: 32,
          eyeColor: "brown",
          company: "LOTRON",
          email: "madgedickerson@xyqag.com",
          phone: "+1 (974) 455-3584",
          address: "225 Scholes Street, National, West Virginia, 7049",
          registered: "<ReferenceError: moment is not defined>",
          latitude: -64.981052,
          longitude: 31.889248
        }
      ];
      // eslint-disable-next-line @lwc/lwc/no-async-operation
      window.setTimeout(function() {
        element.searchListBy("EX", ["company"]);
        element.shadowRoot.querySelector("button").click();

        const data = element.shadowRoot.querySelectorAll("a");
        data[0].dispatchEvent(
          new CustomEvent("mouseenter", {
            bubbles: true,
            composed: true
          })
        );
        data[0].dispatchEvent(
          new CustomEvent("mouseleave", {
            bubbles: true,
            composed: true
          })
        );

        data[0].querySelector(".tableRowCell c-icon").click();
        data[0].click();
        /*data[0].querySelector("c-data-table-cell").dispatchEvent(
        new CustomEvent("edit", {
          bubbles: true,
          composed: true
        })
      );*/

        expect(data).toHaveLength(1);
      });
    });
  });

  it("creates grouped data table", () => {
    const element = createElement("c-data-table", {
      is: datatable
    });
    element.issearchavailable = "true";
    element.issortavailable = "true";
    element.groupBy = "company";

    element.columns = [
      {
        fieldName: "company",
        label: "Company",
        sortable: true,
        searchable: true
      },
      {
        fieldName: "email",
        label: "Email",
        sortable: true,
        searchable: true,
        type: "email",
        editable: true,
        userSelectable: true
      },
      {
        fieldName: "age",
        label: "Age",
        sortable: true,
        type: "number",
        editable: true,
        userSelectable: true
      }
    ];
    element.records = [
      {
        id: "5b5949d7e9a3b7f6e3d0ffcb",
        isActive: true,
        balance: "$3,390.43",
        picture: "http://placehold.it/32x32",
        age: 28,
        eyeColor: "brown",
        company: "EXOSPACE",
        email: "madgedickerson@exospace.com",
        phone: "+1 (977) 568-2404",
        address: "280 Senator Street, Reno, Texas, 1385",
        registered: "<ReferenceError: moment is not defined>",
        latitude: -46.592853,
        longitude: -2.752586
      }
    ];
    element.issearchavailable = "true";
    element.issortavailable = "true";
    element.groupBy = {
      groupFieldName: "company",
      fields: [
        {
          name: "age",
          methodToCalculateSummary: ""
        }
      ],
      groupDescription: ""
    };

    document.body.appendChild(element);
    return Promise.resolve().then(() => {
      // eslint-disable-next-line @lwc/lwc/no-async-operation
      window.setTimeout(function() {
        const ele = element.shadowRoot.querySelectorAll(".tableBody .tableRow");
        expect(ele).toHaveLength(element.records.length);
      });
    });
  });
});
