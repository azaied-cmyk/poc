<template>
    <div class="slds-form-element slds-has-error">
        <span class="slds-form-element__label"
              id="file-selector-primary-label">{label}</span>
        <div class="slds-form-element__control">
            <div class="slds-file-selector slds-file-selector_files">
                <div class="slds-file-selector__dropzone">
                    <input type="file"
                           class="slds-file-selector__input slds-assistive-text"
                           id="file-upload-input-01"
                           multiple={multiple}
                           accept={accept}
                           disabled={disabled}
                           aria-describedby="error-01"
                           aria-labelledby="file-selector-primary-label file-selector-secondary-label" />
                    <label class="slds-file-selector__body"
                           for="file-upload-input-01"
                           id="file-selector-secondary-label">
                        <span class="slds-file-selector__button slds-button slds-button_neutral">
                            <lightning-icon icon-name="utility:upload"
                                            alternative-text="Upload"
                                            size="x-small"
                                            title="Upload"></lightning-icon>
                            &nbsp;
                            Upload Files
                        </span>
                        <span class="slds-file-selector__text slds-medium-show">or Drop Files</span>
                    </label>
                </div>
            </div>
        </div>
        <div if:true={hasError}
             class="slds-form-element__help"
             id="error-01">File type not supported</div>
    </div>

    <template if:true={modalOpen}>
        <section role="dialog"
                 tabindex="-1"
                 class="slds-modal slds-fade-in-open slds-modal_small"
                 aria-labelledby="modal-heading-01"
                 aria-modal="true"
                 aria-describedby="modal-content-id-1">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            title="Close">
                        <svg class="slds-button__icon slds-button__icon_large"
                             aria-hidden="true">
                            <use xlink:href={utilitySpriteUrl}></use>
                        </svg>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-01"
                        class="slds-modal__title slds-hyphenate">Upload Files</h2>
                </header>
                <div class="slds-modal__content slds-p-around_none"
                     id="modal-content-id-1">

                    <template for:each={selectedFiles}
                              for:item="file"
                              for:index="idx">
                        <div class="slds-table--bordered"
                             if:false={file.canceled}
                             key={file.name}>
                            <div class="slds-grid slds-grid--vertical-align-center slds-p-around--small forceContentSingleFileUploader"
                                 data-aura-class="forceContentSingleFileUploader">
                                <div class="slds-col--padded slds-size_6-of-12">
                                    <div class="slds-media slds-media_center">
                                        <div class="slds-media__figure">
                                            <lightning-icon icon-name="doctype:unknown"
                                                            alternative-text={file.altText}
                                                            size="medium"
                                                            title="Upload"></lightning-icon>
                                        </div>
                                        <div class="slds-media__body">
                                            <div class="fileName slds-truncate"
                                                 title={file.name}>
                                                {file.name}
                                            </div>
                                            <span class="slds-text-color--weak slds-text-body--small">
                                                <span>
                                                    <span class="fileSizeAmount uiOutputNumber"
                                                          dir="auto"
                                                          data-aura-class="uiOutputNumber">
                                                        {file.formattedSize.size}
                                                    </span>&nbsp;
                                                    <span class="fileSizeUnits uiOutputText"
                                                          data-aura-class="uiOutputText">
                                                        {file.formattedSize.suffix}
                                                    </span>
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size_5-of-12">
                                    <lightning-progress-bar value={file.progress}
                                                            variant="circular"
                                                            color={file.progressColor}></lightning-progress-bar>
                                    <div class="slds-text-color_destructive"
                                         if:true={file.hasErrors}>
                                        {file.errorMessage}
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size_1-of-12 slds-text-align--center">
                                    <template if:false={file.hasErrors}>
                                        <lightning-button variant="base"
                                                          title={file.altText}
                                                          icon-name={file.actionIcon}
                                                          onclick={onFileRemoveClick}
                                                          data-idx={idx}
                                                          if:true={file.clickableIcon}
                                                          class="slds-m-left_x-small"></lightning-button>
                                        <lightning-icon icon-name={file.actionIcon}
                                                        alternative-text={file.altText}
                                                        size="xx-small"
                                                        title="Upload"
                                                        if:false={file.clickableIcon}>
                                        </lightning-icon>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                </div>
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_brand"
                            disabled={doneDisabled}
                            onclick={onDoneClick}>Done</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>